//*********************************************************** Explanation ***************************************************************//
/*
Last Update : 13960327
*/
//************************************************************* Warning *****************************************************************//
/*
none
*/
//************************************************************* Wizard ******************************************************************//
/*
none
*/
//************************************************************ defineds ******************************************************************//
/*
none
*/
//************************************************************ includes ******************************************************************//
#include "wdt.h"
//************************************************************ variables *****************************************************************//
/*
none
*/
//************************************************************* opjects ******************************************************************//
/*
none
*/
//************************************************************ functions *****************************************************************//
void __init_WDT(void)
{
        WDT_off();
        WDT_Prescaler_Change();
        WDT_Reset();
}
//_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_
void WDT_off(void)
{
        __disable_interrupt();
        __watchdog_reset();
        /* Clear WDRF in MCUSR */
        MCUSR &= ~(1<<WDRF);
        /* Write logical one to WDCE and WDE */
        /* Keep old prescaler setting to prevent unintentional time-out */
        WDTCR |=  (1<<WDTIF) | (1<<WDTIE) | (1<<WDCE);// | (1<<WDE);
        /* Turn off WDT */
        WDTCR = 0x00;
        __enable_interrupt();
}
//_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_
void WDT_Prescaler_Change(void)
{
        __disable_interrupt();
        __watchdog_reset();
        /* Start timed sequence */
        WDTCR |= (1<<WDCE) | (1<<WDE);
        /* Set new prescaler(time-out) value = 128K cycles (~1 s) */
        WDTCR = (1<<WDTIF) | (1<<WDTIE) | (1<<WDCE) | (1<<WDP2) | (1<<WDP1);
        __enable_interrupt();
}
//_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_
void WDT_Reset(void)
{
        __disable_interrupt();
        __watchdog_reset(); 
        __enable_interrupt();
}
//*************************************************************** tasks *******************************************************************//
/*
none
*/
//************************************************************** vectors ******************************************************************//
#pragma vector = WDT_vect
__interrupt  void Watchdog_Time_out(void)
{
        __watchdog_reset();
}
//****************************************************************************************************************************************//

